<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verhuursysteem Kolven</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Verhuursysteem voor Kolven</h1>
    <form id="rentalForm">
        <label for="kolfName">Kolfnaam:</label>
        <div style="display: flex; align-items: center;">
            <select id="kolfName" style="margin-right: 10px;"></select>
            <button type="button" onclick="addKolf()">Kolf Toevoegen</button>
            <button type="button" onclick="removeKolf()">Kolf Verwijderen</button>
        </div>


        </select>
        <label for="borrowerName">Naam:</label>
        <input type="text" id="borrowerName" required>
        <label for="receiverLocation">Adres:</label>
        <input type="text" id="receiverLocation" required>
        <label for="receiverContact">GSM:</label>
        <input type="text" id="receiverContact" required>
        <div>
            <button type="button" style="display: inline-block;" onclick="rentKolf()">Kolf uitlenen</button>
            <button type="button" style="display: inline-block;" onclick="goToTerugname()">terugname</button>
        </div>


    </form>

    <h2>Historiek Verhuur</h2>
    <table id="rentalHistory">
        <tr>
            <th>Kolf</th>
            <th>Naam</th>
            <th>Adres</th>
            <th>GSM</th>
            <th>Datum Uitgeleend</th>
            <th>Verwijderen</th> <!-- Nieuwe kolom voor de verwijderknop -->
        </tr>
    </table>

    <!-- Firebase SDK-scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // Functie om gegevens in Local Storage op te slaan
        function saveToLocalStorage(data) {
            localStorage.setItem('rentalHistory', JSON.stringify(data));
        }

        // Functie om gegevens uit Local Storage op te halen
        function getFromLocalStorage() {
            const data = localStorage.getItem('rentalHistory');
            return data ? JSON.parse(data) : [];
        }

        // Verhuur geschiedenis bijhouden
        let rentalHistory = getFromLocalStorage();

        // Functie om de lijst van beschikbare kolven op te slaan in Local Storage
        function saveKolfListToLocalStorage(data) {
            localStorage.setItem('kolfList', JSON.stringify(data));
        }

        // Functie om de lijst van beschikbare kolven uit Local Storage op te halen
        function getKolfListFromLocalStorage() {
            const data = localStorage.getItem('kolfList');
            return data ? JSON.parse(data) : [
                "Kolf 1",
                "Kolf 2",
                "Kolf 3",
                "Kolf 4",
                "Kolf 5",
                "Kolf 6"
            ];
        }

        // Lijst van beschikbare kolven, bij het openen van de pagina
        let kolfList = getKolfListFromLocalStorage();

        // Functie om een kolf uit te lenen
        function rentKolf() {
            const kolfName = document.getElementById("kolfName").value;
            const borrowerName = document.getElementById("borrowerName").value;
            const receiverLocation = document.getElementById("receiverLocation").value;
            const receiverContact = document.getElementById("receiverContact").value;
            const currentDate = new Date().toLocaleDateString();

            // Voeg de uitgeleende kolf toe aan de geschiedenis
            rentalHistory.push({
                kolf: kolfName,
                borrower: borrowerName,
                location: receiverLocation,
                contact: receiverContact,
                date: currentDate
            });

            // Upload de geschiedenis naar Firebase
            db.collection("historiek_verhuur")
                .add({
                    kolf: kolfName,
                    borrower: borrowerName,
                    location: receiverLocation,
                    contact: receiverContact,
                    date: currentDate
                })
                .then(function (docRef) {
                    console.log("Document written with ID: ", docRef.id);
                })
                .catch(function (error) {
                    console.error("Error adding document: ", error);
                });

            // Sla de geschiedenis op in Local Storage
            saveToLocalStorage(rentalHistory);

            // Vernieuw de tabel met de geschiedenis
            updateRentalHistoryTable();

            // Reset het formulier
            document.getElementById("rentalForm").reset();
        }

        // Functie om een verhuur te verwijderen
        function removeRental(index) {
            rentalHistory.splice(index, 1); // Verwijder de verhuur op de opgegeven index
            saveToLocalStorage(rentalHistory);
            updateRentalHistoryTable();
        }

        // Functie om de verhuur geschiedenis tabel te updaten
        function updateRentalHistoryTable() {
            const table = document.getElementById("rentalHistory");
            table.innerHTML = `
                <tr>
                    <th>Kolf</th>
                    <th>Naam</th>
                    <th>Adres</th>
                    <th>GSM</th>
                    <th>Datum Uitgeleend</th>
                    <th>Verwijderen</th> <!-- Nieuwe kolom voor de verwijderknop -->
                </tr>
            `;

            // Vul de tabel met de verhuur geschiedenis
            for (let i = rentalHistory.length - 1; i >= 0; i--) {
                const rental = rentalHistory[i];
                const row = table.insertRow();
                const kolfCell = row.insertCell(0);
                const borrowerCell = row.insertCell(1);
                const locationCell = row.insertCell(2);
                const contactCell = row.insertCell(3);
                const dateCell = row.insertCell(4);
                const removeCell = row.insertCell(5);

                kolfCell.textContent = rental.kolf;
                borrowerCell.textContent = rental.borrower;
                locationCell.textContent = rental.location;
                contactCell.textContent = rental.contact;
                dateCell.textContent = rental.date;

                const removeButton = document.createElement("button");
                removeButton.textContent = "Verwijderen";
                removeButton.addEventListener("click", function () {
                    removeRental(i); // Verwijder de verhuur op basis van de index i
                });

                removeCell.appendChild(removeButton);
            }
        }

        // Functie om een kolf toe te voegen
        function addKolf() {
            const newKolfName = prompt("Voer de naam van de nieuwe kolf in:");
            if (newKolfName) {
                // Controleer of de kolf al in de lijst staat voordat deze wordt toegevoegd
                const existingKolf = kolfList.find(kolf => kolf === newKolfName);
                if (!existingKolf) {
                    kolfList.push(newKolfName); // Voeg de nieuwe kolf toe aan de lijst
                    saveKolfListToLocalStorage(kolfList); // Sla de bijgewerkte lijst op in Local Storage

                    // Voeg de nieuwe kolf ook toe aan de selectbox in het formulier
                    const option = document.createElement("option");
                    option.value = newKolfName;
                    option.textContent = newKolfName;
                    document.getElementById("kolfName").appendChild(option);
                } else {
                    alert("Kolf bestaat al in de lijst.");
                }
            }
        }

        // Functie om een kolf te verwijderen
        function removeKolf() {
            const selectedKolf = document.getElementById("kolfName").value;
            // Controleer of de geselecteerde kolf in de lijst van kolven staat voordat deze wordt verwijderd
            const existingKolf = kolfList.find(kolf => kolf === selectedKolf);
            if (existingKolf) {
                kolfList = kolfList.filter(kolf => kolf !== selectedKolf); // Verwijder de kolf uit de lijst
                saveKolfListToLocalStorage(kolfList); // Sla de bijgewerkte lijst op in Local Storage
                const selectBox = document.getElementById("kolfName");
                selectBox.innerHTML = ""; // Leeg de selectbox
                populateKolfSelectBox(); // Vul de selectbox opnieuw
            } else {
                alert("Geselecteerde kolf komt niet voor in de lijst van beschikbare kolven.");
            }
        }

        // Functie om de selectbox van kolven te vullen bij het laden van de pagina
        function populateKolfSelectBox() {
            const selectBox = document.getElementById("kolfName");
            kolfList.forEach(kolf => {
                const option = document.createElement("option");
                option.value = kolf;
                option.textContent = kolf;
                selectBox.appendChild(option);
            });
        }

        // Roep deze functie aan het begin op om de selectbox van kolven te vullen
        populateKolfSelectBox();

        // Firebase-configuratiegegevens
        const firebaseConfig = {
            apiKey: "AIzaSyDQIPJ2krHjmaoNktCCMN8GOGK__dZb4mM",
            authDomain: "kolven-de-wolk.firebaseapp.com",
            databaseURL: "https://kolven-de-wolk-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kolven-de-wolk",
            storageBucket: "kolven-de-wolk.appspot.com",
            messagingSenderId: "884692076697",
            appId: "1:884692076697:web:628461d6e132ba7f6b5008",
            measurementId: "G-ZHH5S6MBJH"
            
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Laad de initiële verhuur geschiedenis bij het openen van de pagina
        db.collection("historiek_verhuur")
            .get()
            .then(function (querySnapshot) {
                rentalHistory = [];
                querySnapshot.forEach(function (doc) {
                    rentalHistory.push(doc.data());
                });
                updateRentalHistoryTable();
            })
            .catch(function (error) {
                console.log("Error getting documents: ", error);
            });

        // Vul het formulier met opgeslagen gegevens bij hernieuwing van de pagina
        document.getElementById("kolfName").value = localStorage.getItem("kolfName");
        document.getElementById("borrowerName").value = localStorage.getItem("borrowerName");
        document.getElementById("receiverLocation").value = localStorage.getItem("receiverLocation");
        document.getElementById("receiverContact").value = localStorage.getItem("receiverContact");

        // Sla de ingevoerde gegevens op in Local Storage wanneer het formulier wordt ingevuld
        document.getElementById("rentalForm").addEventListener("input", function() {
            localStorage.setItem("kolfName", document.getElementById("kolfName").value);
            localStorage.setItem("borrowerName", document.getElementById("borrowerName").value);
            localStorage.setItem("receiverLocation", document.getElementById("receiverLocation").value);
            localStorage.setItem("receiverContact", document.getElementById("receiverContact").value);
        });
    </script>
</body>
</html>
